<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Blog | Igor Laltuf</title>
    <link>https://igorlaltuf.github.io/post/</link>
      <atom:link href="https://igorlaltuf.github.io/post/index.xml" rel="self" type="application/rss+xml" />
    <description>Blog</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>pt-br</language><copyright>© 2022 Igor Laltuf</copyright><lastBuildDate>Mon, 24 Jan 2022 00:00:00 +0000</lastBuildDate>
    <image>
      <url>https://igorlaltuf.github.io/media/icon_hu765fed44f9da9f8bbfd31b2fd32d48fd_17366_512x512_fill_lanczos_center_3.png</url>
      <title>Blog</title>
      <link>https://igorlaltuf.github.io/post/</link>
    </image>
    
    <item>
      <title>Como usar o pacote sidraR</title>
      <link>https://igorlaltuf.github.io/post/como-usar-o-pacote-sidrar/</link>
      <pubDate>Mon, 24 Jan 2022 00:00:00 +0000</pubDate>
      <guid>https://igorlaltuf.github.io/post/como-usar-o-pacote-sidrar/</guid>
      <description>
&lt;script src=&#34;https://igorlaltuf.github.io/post/como-usar-o-pacote-sidrar/index_files/header-attrs/header-attrs.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;O pacote sidraR permite acessar os dados do &lt;a href=&#34;https://sidra.ibge.gov.br/&#34;&gt;Sidra&lt;/a&gt; (Sistema IBGE de Recuperação Automática) diretamente pelo R. No exemplo de hoje, vamos fazer um levantamento para descobrir quais foram os municípios brasileiros responsáveis pela maior parte do valor de soja produzido nas regiões Norte e Centro-Oeste em 2020.&lt;/p&gt;
&lt;p&gt;Vamos agrupar os valores de cada município que produz soja em quatro categorias - baixo, médio baixo, médio alto e alto. Os intervalos abrangidos pelas categorias serão definidos por meio dos quartis.&lt;/p&gt;
&lt;p&gt;Como o pacote está no &lt;a href=&#34;https://cran.r-project.org/web/packages/sidrar/index.html&#34;&gt;CRAN&lt;/a&gt;, a instalação será pelo comando:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;install.packages(&amp;#39;sidrar&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A função abaixo permite identificar aquelas tabelas do IBGE que contenham determinadas palavras-chave em seus títulos. &lt;strong&gt;Importante&lt;/strong&gt;: não é permitido usar acentos nessa função.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- search_sidra(&amp;#39;lavouras temporarias valor da producao&amp;#39;)
x&lt;/code&gt;&lt;/pre&gt;
&lt;pre style=&#34;max-height: 500px;&#34;&gt;&lt;code&gt;##  [1] &amp;quot;Tabela 498 - Valor da produção por produtos das lavouras temporárias e grupos de área total&amp;quot;                                                                                                                                                                                                                                        
##  [2] &amp;quot;Tabela 499 - Valor da produção por produtos das lavouras temporárias e grupo de atividade econômica&amp;quot;                                                                                                                                                                                                                                
##  [3] &amp;quot;Tabela 500 - Valor da produção por produtos das lavouras temporárias e condição do produtor em relação às terras&amp;quot;                                                                                                                                                                                                                   
##  [4] &amp;quot;Tabela 822 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária por produtos da lavoura temporária, condição produtor em relação às terras, grupos de atividade econômica, grupos de área total e grupos de área colhida&amp;quot;                                                                                      
##  [5] &amp;quot;Tabela 824 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária por produtos da lavoura temporária, tipo de semente, tipo de colheita, tipo de cultivo e destino da produção&amp;quot;                                                                                                                                  
##  [6] &amp;quot;Tabela 825 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária por produtos da lavoura temporária, uso de irrigação, uso de agrotóxicos, uso de adubação e principal mês de plantio e de colheita&amp;quot;                                                                                                            
##  [7] &amp;quot;Tabela 1272 - Produtos da lavoura temporária nos estabelecimentos agropecuários, segundo indicadores da agricultura familiar e não familiar - FAO&amp;quot;                                                                                                                                                                                  
##  [8] &amp;quot;Tabela 1612 - Área plantada, área colhida, quantidade produzida, rendimento médio e valor da produção das lavouras temporárias&amp;quot;                                                                                                                                                                                                     
##  [9] &amp;quot;Tabela 1712 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária nos estabelecimentos agropecuários, por produtos da lavoura temporária, condição produtor em relação às terras, grupos de atividade econômica, grupos de área total e grupos de área colhida - (MDA - PRONAF)&amp;quot;                                
## [10] &amp;quot;Tabela 1716 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária nos estabelecimentos agropecuários, por produtos da lavoura temporária, tipo de semente, tipo de colheita e tipo de cultivo - (MDA - PRONAF)&amp;quot;                                                                                                 
## [11] &amp;quot;Tabela 1720 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária nos estabelecimentos agropecuários, por produtos da lavoura temporária, uso de agrotóxicos, uso de adubação e principal mês de plantio e de colheita - (MDA - PRONAF)&amp;quot;                                                                        
## [12] &amp;quot;Tabela 1723 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária nos estabelecimentos agropecuários, por produtos da lavoura temporária, destino da produção e uso de irrigação - (MDA - PRONAF)&amp;quot;                                                                                                              
## [13] &amp;quot;Tabela 1823 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária por produtos da lavoura temporária e grupos e classes de atividade&amp;quot;                                                                                                                                                                           
## [14] &amp;quot;Tabela 2237 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária nos estabelecimentos agropecuários, com agricultura familiar e não familiar, por produtos da lavoura temporária, condição produtor em relação às terras, grupos de atividade econômica, grupos de área total e grupos de área colhida - (MDA)&amp;quot;
## [15] &amp;quot;Tabela 2265 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária nos estabelecimentos agropecuários, com agricultura familiar e não familiar, por produtos da lavoura temporária, tipo de semente, tipo de colheita e tipo de cultivo - (MDA)&amp;quot;                                                                 
## [16] &amp;quot;Tabela 2266 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária nos estabelecimentos agropecuários, com agricultura familiar e não familiar, por produtos da lavoura temporária, uso de agrotóxicos, uso de adubação e principal mês de plantio e de colheita - (MDA)&amp;quot;                                        
## [17] &amp;quot;Tabela 2284 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária nos estabelecimentos agropecuários, com agricultura familiar e não familiar, por produtos da lavoura temporária, destino da produção e uso de irrigação - (MDA)&amp;quot;                                                                              
## [18] &amp;quot;Tabela 2868 - Produção, Valor da produção e Área colhida da lavoura temporária por produtos da lavoura temporária, grupos e classes de atividade econômica e uso de agricultura orgânica&amp;quot;                                                                                                                                           
## [19] &amp;quot;Tabela 3374 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária por produtos da lavoura temporária, sexo e residência do produtor, orientação técnica, origem da orientação técnica e nivel de instrução da pessoa que dirige o estabelecimento&amp;quot;                                                              
## [20] &amp;quot;Tabela 3411 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária por produtos da lavoura temporária, segundo indicadores da agricultura familiar e não familiar - FAO&amp;quot;                                                                                                                                         
## [21] &amp;quot;Tabela 4109 - Produção, Venda, Valor da produção e Área colhida da lavoura temporária, por produtos da lavoura temporária, tipo de colheita, tipo de semente e classificações de médio produtor&amp;quot;                                                                                                                                    
## [22] &amp;quot;Tabela 5457 - Área plantada ou destinada à colheita, área colhida, quantidade produzida, rendimento médio e valor da produção das lavouras temporárias e permanentes&amp;quot;                                                                                                                                                               
## [23] &amp;quot;Tabela 6957 - Produção, Valor da produção, Venda, Valor da venda e Área colhida da lavoura temporária nos estabelecimentos agropecuários, por tipologia, produtos da lavoura temporária, condição do produtor em relação às terras e grupos de atividade econômica&amp;quot;                                                                 
## [24] &amp;quot;Tabela 6958 - Produção, Valor da produção, Venda, Valor da venda e Área colhida da lavoura temporária nos estabelecimentos agropecuários, por tipologia, produtos da lavoura temporária, tipo de semente e grupos de área colhida&amp;quot;                                                                                                  
## [25] &amp;quot;Tabela 6959 - Produção, Valor da produção, Venda, Valor da venda e Área colhida da lavoura temporária nos estabelecimentos agropecuários, por tipologia, produtos da lavoura temporária e grupos de área total&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Após uma breve leitura dos nomes das tabelas, percebe-se que a informação que precisamos está na Tabela 1612, que contém o valor da produção (em mil reais) provenientes da pesquisa de Produção Agrícola Municipal. Agora, basta usar a função get_sidra() para baixar os dados da tabela direto para o R na estrutura de um dataframe. Na própria função é possível selecionar os dados que serão baixados de acordo com recorte geográfico, filtrar apenas dados de determinada região ou até mesmo selecionar uma variável específica.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- get_sidra(x = 1612)&lt;/code&gt;&lt;/pre&gt;
&lt;iframe seamless src=&#34;tab1.html&#34; width=&#34;100%&#34; height=&#34;500&#34;&gt;
&lt;/iframe&gt;
&lt;p&gt;Como o objetivo aqui é baixar os dados com o valor da produção, eu seleciono a variável número 215 (valor da produção) por meio do atributo “variable”. O problema é que ao usar a função get_sidra para baixar os dados da tabela, somos surpreendidos com a mensagem: “Quantidade de valores solicitados X linhas excedeu o limite: 50000”. Ou seja, existe uma limitação de que os dados baixados sejam de apenas 50.000 por requisição. Para contornar essa limitação, a solução foi fazer uma requisição para cada região e ir armazenando os resultados em uma tabela que criativamente foi chamada de “tabela”.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;regiao &amp;lt;- c(1,5)
tabela &amp;lt;- data.frame()

for(i in regiao){
  x &amp;lt;- get_sidra(x = 1612, # código da tabela no Sidra
                 geo = &amp;#39;City&amp;#39;, # nível de detalhe espacial da informação
                 geo.filter = list(&amp;quot;Region&amp;quot; = i), #região
                 variable = 215, # variável de interesse
                 period = as.character(2020) # ano dos dados
                 )
tabela &amp;lt;- rbind(tabela,x)
}
x &amp;lt;- datatable(tabela)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como resultado temos a seguinte tabela:&lt;/p&gt;
&lt;iframe seamless src=&#34;x.html&#34; width=&#34;100%&#34; height=&#34;500&#34;&gt;
&lt;/iframe&gt;
&lt;p&gt;Agora vamos filtrar a produção de soja, selecionar apenas aquelas variáveis (colunas do meu dataframe) que serão usadas, substituir os valores faltantes por zero, remover os municípios que tem valor igual a zero e classificar os valores de acordo com as categorias.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tabela_class &amp;lt;- tabela %&amp;gt;%
  janitor::clean_names() %&amp;gt;%
  select(5,6,7,9,13) %&amp;gt;%
  replace(is.na(.), 0) %&amp;gt;% 
  dplyr::filter(produto_das_lavouras_temporarias %in% &amp;quot;Soja (em grão)&amp;quot;,
                valor &amp;gt; 0) %&amp;gt;%
  arrange(desc(valor)) 

tabela_class &amp;lt;- tabela_class %&amp;gt;% 
  mutate(class = case_when(
         valor &amp;lt;= summary(tabela_class$valor)[2] ~ &amp;quot;Baixo&amp;quot;,
         valor &amp;lt;= summary(tabela_class$valor)[3] ~ &amp;quot;Médio Baixo&amp;quot;,
         valor &amp;lt;= summary(tabela_class$valor)[5] ~ &amp;quot;Médio Alto&amp;quot;,
         valor &amp;gt; summary(tabela_class$valor)[5] ~ &amp;quot;Alto&amp;quot;
         ),
         class = factor(class,
                        levels = c(&amp;quot;Baixo&amp;quot;,&amp;quot;Médio Baixo&amp;quot;,&amp;quot;Médio Alto&amp;quot;,&amp;quot;Alto&amp;quot;))
         )
tabela_class$municipio_codigo &amp;lt;- as.double(tabela_class$municipio_codigo)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Pronto! Como resultado, temos uma tabela que mostra quais os municípios que mais produziram soja em 2020, de acordo com o valor da produção.&lt;/p&gt;
&lt;iframe seamless src=&#34;tab_class.html&#34; width=&#34;100%&#34; height=&#34;500&#34;&gt;
&lt;/iframe&gt;
&lt;p&gt;Uma outra forma mais interessante de visualizar os dados é por meio de um mapa:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(mapview)
library(geobr)
library(RColorBrewer)
mapviewOptions(fgb = FALSE)
mapa_soja &amp;lt;- geobr::read_municipality(showProgress = F) %&amp;gt;% 
  filter(str_detect(code_state, &amp;quot;^1|^5&amp;quot;)) %&amp;gt;% 
  left_join(tabela_class, by = c(&amp;#39;code_muni&amp;#39; = &amp;#39;municipio_codigo&amp;#39;))

mapa_soja &amp;lt;- mapview::mapview(mapa_soja, zcol = &amp;quot;class&amp;quot;, label = &amp;#39;name_muni&amp;#39;, col.regions = brewer.pal(4, &amp;quot;YlOrRd&amp;quot;))

mapview::mapshot(mapa_soja, url = &amp;#39;mapa.html&amp;#39;) # salva mapview em html&lt;/code&gt;&lt;/pre&gt;
&lt;iframe seamless src=&#34;mapa.html&#34; width=&#34;100%&#34; height=&#34;500&#34;&gt;
&lt;/iframe&gt;
</description>
    </item>
    
  </channel>
</rss>
